#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Thu Mar 14 23:04:44 2018

@author: kinga
""" 

import numpy as np
from math import degrees, sin, cos, atan2, pi, asin
import matplotlib.pyplot as plt
from matplotlib.pyplot import rc, rcParams

def groundtrack_latlon(xs, ys, zs):
    """
    function which converts ECEF satellite position position to latitude and longitude
    Based on rvtolatlong.m in Richard Rieber's orbital library on mathwork.com

    Note: that this is only suitable for groundtrack visualization, not rigorous
    calculations.
    """
    R = [xs, ys, zs]
    r_delta = np.linalg.norm(R[0:1]);
    sinA = R[1]/r_delta;
    cosA = R[0]/r_delta;

    Lon = atan2(sinA,cosA)

    if Lon < - pi:
        Lon = Lon + 2 * pi;
    Lat = asin(R[2]/np.linalg.norm(R))
    return degrees(Lat), degrees(Lon)


def groundtrack(lon_lat_ground):
    '''
    Ploting satellite ground track:
        Satellite groundtrack longitude and latitude are calculated 
        from XYZ(ECEF) satellites bythe use of function(above): groundtrack_latlon(xs, ys, zs)
    
    INPUT:
        lon_lat_ground ; list of list [lon, lat]
        Coastline.txt - file with coastline coordinate
    '''
    # GENERAL setup
    rc('text', usetex=True)
    rc('font', family='serif');
    rc('font',family='helvetica');
    rc('grid', color='gray', linewidth=0.1, linestyle='--')
    fontsize = 20
    rc('xtick', labelsize = fontsize)
    rc('ytick', labelsize = fontsize)
    rc('font', size = fontsize)
    params = {'legend.fontsize': 8,  'legend.handlelength': 2}
    rcParams.update(params)
    
    # FILE with coastline coordinate
    coastline_data= np.loadtxt('Coastline.txt',skiprows=1)
    
    # define figure
    w, h = plt.figaspect(0.5)
    fig = plt.figure(figsize=(w,h))
    ax = fig.gca() # add iteratively

    fig.suptitle('GPS Ground Track',fontsize=16)
    plt.plot(coastline_data[:,0],coastline_data[:,1],'g', linewidth=0.5);
    ax.set_xlabel('Longitude $[\mathrm{^\circ}]$',fontsize=14)
    ax.set_ylabel('Latitude $[\mathrm{^\circ}]$',fontsize=14)
    plt.xlim(-180,180);
    plt.ylim(-90,90);
    plt.yticks([-90,-80,-70,-60,-50,-40,-30,-20,-10,0,10,20,30,40,50,60,70,80,90]);
    plt.xticks([-180,-150,-120,-90,-60,-30,0,30,60,90,120,150,180]);
    
    for pos in lon_lat_ground:
        lon_ground = pos[0]
        lat_ground = pos[1]
        print(lon_ground, lat_ground)
        plt.plot(lon_ground, lat_ground,'b.', markersize=2)
        
     
    ax.grid(True)
    # fig.savefig('plot_world_map_groundtrack.png',format='png',bbox_inches='tight', pad_inches=0.01, dpi=1200)
    # fig.savefig('plot_world_map_groundtrack.pdf',format='pdf',bbox_inches='tight', pad_inches=0.01, dpi=1200)
    
    
if __name__ =='__main__':
    # example data for GPS satellite prn08 
    lon_lat_ground = [[-17.75942799689384,53.8367825402274],
    [-12.463655327921455,52.14243735233564],
    [-7.819051762716955,49.97547049625131],
    [-3.8472660979330064,47.410354414972005],
    [-0.5161554403785877,44.51698495248898],
    [2.2362906716134554,41.356663482723576],
    [4.483984014815667,37.98096573118386],
    [6.301650738308081,34.4322697167681],
    [7.759102761270903,30.745010004401305],
    [8.91895235088856,26.947107947878177],
    [9.836266018843295,23.06131250722568],
    [10.559184996788055,19.106354188065993],
    [11.129953526985785,15.097899109597474],
    [11.58606429355624,11.049326329210547],
    [11.961387301571252,6.972363258264112],
    [12.287234478266388,2.87761491792959],
    [12.593356893739914,-1.2249801177257373],
    [12.90889345094842,-5.325737668782455],
    [13.263299843745282,-9.414832873307219],
    [13.687289966434848,-13.481896198704705],
    [14.213820714654862,-17.5155740147795],
    [14.879144335532313,-21.503024963923128],
    [15.723936065246686,-25.42931989018395],
    [16.794470040721087,-29.27670940864833],
    [18.143747539574136,-33.023721790709075],
    [19.832352116629632,-36.64406018102179],
    [21.928577437234555,-40.10529337368536],
    [24.507002378993004,-43.36739903889144],
    [27.644165982885056,-46.38135543640105],
    [31.40946159246905,-49.088226966435066],
    [35.8493379032842,-51.41956165871931],
    [40.96448117913057,-53.30030250025818],
    [46.684220650722146,-54.65542865396971],
    [52.84951355053261,-55.42054260581342],
    [59.22005295118248,-55.55428726740907],
    [65.51329684703028,-55.04796624857581],
    [71.46315947055022,-53.92766103138684],
    [76.87081554604843,-52.24771240655973],
    [81.62641442897072,-50.078990392231226],
    [85.70122359675446,-47.497061081021286],
    [89.12411026406936,-44.57364525073132],
    [91.95653530418043,-41.37209419024659],
    [94.27340833941304,-37.94597332659488],
    [96.15113462438687,-34.33947204922272],
    [97.66137447479018,-30.588635440655175],
    [98.86850622188481,-26.722815416153278],
    [99.82918528440896,-22.76604640539579],
    [100.59295236992523,-18.738234389496245],
    [101.20328781848359,-14.656141274687187],
    [101.69879807961777,-10.534186868531055],
    [102.11438965869134,-6.385104155283364],
    [102.48237847337937,-2.220485058083791],
    [102.83353045755494,1.9487489174076078],
    [103.19805260126722,6.111920224123192],
    [103.60656387076997,10.258184619383476],
    [104.09107833068204,14.376108971653858],
    [104.68603011306382,18.453209549718945],
    [105.42936021797534,22.475420656985623],
    [106.36366334396111,26.426460360071022],
    [107.53734856837939,30.2870574350264],
    [109.00568222621771,34.03400480331645],
    [110.83142526712867,37.639016590810165],
    [113.08451070086599,41.06740203783856],
    [115.83979441957918,44.27665353448741],
    [119.17138209429524,47.215212896320445],
    [123.14161927136298,49.821962762034204],
    [127.78321032645385,52.02736954722598],
    [133.0753425712422,53.7574971367267],
    [138.92014412448427,54.941849160773636],
    [145.1325142093374,55.524583257412985],
    [151.45735021500278,55.47614362230551],
    [157.61604383935523,54.80047251649656],
    [163.3640604243595,53.534107531177675],
    [168.53264061277042,51.73763535388447],
    [173.04005707730437,49.48373338590557],
    [176.87766803795577,46.84644898493057],
    [-179.91451684113227,43.89414348147457],
    [-177.27084603608722,40.686161432528856],
    [-175.11654708960643,37.27213086149859],
    [-173.37756740371069,33.6927013707837],
    [-171.98545534523268,29.98086765317159],
    [-170.87914750271477,26.16339604761749],
    [-170.00505514371721,22.26213154023795],
    [-169.3163262362022,18.295110423844346],
    [-168.77177623509724,14.277475928942321],
    [-168.3347387898308,10.222223742563967],
    [-167.9719479740289,6.140813008577105],
    [-167.65248809061868,2.04367813155843],
    [-167.3468082974492,-2.0593264880687383],
    [-167.02578044680504,-6.158519976362139],
    [-166.65977022683202,-10.244000190531889],
    [-166.21768931059825,-14.305234723049287],
    [-165.66599842249684,-18.330610847793523],
    [-164.96763951985798,-22.306915016994758],
    [-164.08089454335115,-26.218708886808372],
    [-162.9582083170014,-30.047565361963844],
    [-161.5450918880887,-33.77112773961864],
    [-159.77936876343202,-37.361964062655744],
    [-157.59128098006155,-40.786219979171065],
    [-154.9053756580525,-44.00214972647016],
    [-151.64563635735666,-46.958761717003505],
    [-147.745813628528,-49.5950908508977],
    [-143.1667227052993,-51.841000352238595],
    [-137.9201797104758,-53.62076630964805],
    [-132.09400714051108,-54.86056155730649],
    [-125.86537654752688,-55.49967974540637],
    [-119.48730833610401,-55.502814224558016],
    [-113.24393086783496,-54.86846579746546],
    [-107.39101246210762,-53.62923288526097],
    [-102.10995466450218,-51.84384217656198],
    [-97.49272482610205,-49.585001461112135],
    [-93.55421926439988,-46.928051861505594],
    [-90.25704854807677,-43.94325895389376],
    [-87.53570796057585,-40.69202154395437],
    [-85.31423084802933,-37.22592659048289],
    [-83.51681972580793,-33.587394036554656],
    [-82.07317737976663,-29.81099004800128],
    [-80.9205062280198,-25.924879062901056],
    [-80.00366788403817,-21.95216644631414],
    [-79.27444689914596,-17.912045494534155],
    [-78.69045106598178,-13.820742210862594],
    [-78.2139196552661,-9.692284402086866],
    [-77.8105604340278,-5.539131732451285],
    [-77.44845497457192,-1.372703541664525],
    [-77.09703015728007,2.796161899927756],
    [-76.72607378632051,6.956786387297457],
    [-76.30476379999497,11.09824099119161],
    [-75.80067884880742,15.208918145205187],
    [-75.1787618891959,19.276058304801822],
    [-74.400220008382,23.285200455393884],
    [-73.42136901301241,27.219522573911092],
    [-72.19248223145154,31.05903593819625],
    [-70.65680002236695,34.77959978026375],
    [-68.75003157542929,38.3517381940736],
    [-66.40097482177292,41.73928474504541],
    [-63.534322742936844,44.89797800539767],
    [-60.077261038594045,47.774319579130626],
    [-55.971790252418295,50.30531346822892],
    [-51.19402783456912,52.420090386250706],
    [-45.77875690882153,54.04464834109674],
    [-39.84148239819206,55.11048821111759],
    [-33.58398556639127,55.566239411300735],
    [-27.27065980295508,55.38880434779941],
    [-21.177704558322496,54.589113227479906]]
#    lon_lat_ground = [[21.0, 52.0], [45.0, 10.]]
groundtrack(lon_lat_ground)
    
    
    
    
    
    
    
